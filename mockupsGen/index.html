<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mockup Editor Pro</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Mockup Editor">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>Mockup Editor Pro</h1>
            <div class="header-actions">
                <button id="saveAllBtn" class="btn btn-primary">üíæ Save All Changes</button>
                <button id="exportBtn" class="btn btn-success">üì• Export Mockup</button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar - Mockup Library -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h2>Mockup Library</h2>
                    <button id="addMockupBtn" class="btn btn-secondary btn-block">+ Add Custom Mockup</button>
                    <input type="file" id="mockupUpload" accept="image/*" style="display:none;">

                    <div class="mockup-categories">
                        <button class="category-btn active" data-category="all">All</button>
                        <button class="category-btn" data-category="apparel">Apparel</button>
                        <button class="category-btn" data-category="accessories">Accessories</button>
                        <button class="category-btn" data-category="custom">Custom</button>
                    </div>

                    <div id="mockupList" class="mockup-list"></div>
                </div>

                <!-- Design Library -->
                <div class="sidebar-section">
                    <h2>Design Library</h2>
                    <button id="addDesignBtn" class="btn btn-secondary btn-block">+ Upload Design</button>
                    <input type="file" id="designUpload" accept="image/*" multiple style="display:none;">
                    <div id="designList" class="design-list"></div>
                </div>
            </aside>

            <!-- Canvas Area -->
            <main class="canvas-area">
                <div class="canvas-toolbar">
                    <div class="toolbar-group">
                        <button id="addPlaceholderBtn" class="btn btn-icon" title="Add Placeholder">‚ûï Placeholder</button>
                        <button id="removePlaceholderBtn" class="btn btn-icon" title="Remove Selected">üóëÔ∏è Delete</button>
                        <button id="duplicatePlaceholderBtn" class="btn btn-icon" title="Duplicate">üìã Copy</button>
                    </div>
                    <div class="toolbar-group">
                        <button id="toggleGridBtn" class="btn btn-icon" title="Toggle Grid">üìê Grid</button>
                        <button id="toggleSnapBtn" class="btn btn-icon active" title="Toggle Snapping">üß≤ Snap</button>
                        <button id="centerObjectBtn" class="btn btn-icon" title="Center Object">‚äπ Center</button>
                    </div>
                    <div class="toolbar-group">
                        <button id="layerUpBtn" class="btn btn-icon" title="Bring Forward">‚¨ÜÔ∏è</button>
                        <button id="layerDownBtn" class="btn btn-icon" title="Send Backward">‚¨áÔ∏è</button>
                    </div>
                </div>

                <div class="canvas-wrapper">
                    <canvas id="mainCanvas"></canvas>
                </div>

                <div class="canvas-info">
                    <span id="canvasZoom">100%</span>
                    <span id="canvasSize">No mockup loaded</span>
                </div>
            </main>

            <!-- Properties Panel -->
            <aside class="properties-panel">
                <h2>Properties</h2>

                <div id="noSelectionMsg" class="no-selection">
                    <p>Select a placeholder or object to edit properties</p>
                </div>

                <div id="propertiesContent" class="properties-content" style="display:none;">
                    <!-- Transform -->
                    <div class="property-group">
                        <h3>Transform</h3>
                        <div class="property-row">
                            <label>X:</label>
                            <input type="number" id="propX" class="input-small">
                        </div>
                        <div class="property-row">
                            <label>Y:</label>
                            <input type="number" id="propY" class="input-small">
                        </div>
                        <div class="property-row">
                            <label>Width:</label>
                            <input type="number" id="propWidth" class="input-small">
                        </div>
                        <div class="property-row">
                            <label>Height:</label>
                            <input type="number" id="propHeight" class="input-small">
                        </div>
                        <div class="property-row">
                            <label>Rotation:</label>
                            <input type="number" id="propRotation" class="input-small" min="-360" max="360">
                            <span>¬∞</span>
                        </div>
                    </div>

                    <!-- Aspect Ratio -->
                    <div class="property-group">
                        <h3>Aspect Ratio</h3>
                        <select id="aspectRatioSelect" class="select-full">
                            <option value="free">Free</option>
                            <option value="1:1">1:1 (Square)</option>
                            <option value="4:3">4:3</option>
                            <option value="16:9">16:9</option>
                            <option value="3:4">3:4 (Portrait)</option>
                            <option value="9:16">9:16 (Portrait)</option>
                        </select>
                        <label class="checkbox-label">
                            <input type="checkbox" id="lockAspectRatio">
                            Lock Aspect Ratio
                        </label>
                    </div>

                    <!-- Opacity & Effects -->
                    <div class="property-group">
                        <h3>Appearance</h3>
                        <div class="property-row">
                            <label>Opacity:</label>
                            <input type="range" id="propOpacity" min="0" max="100" value="100">
                            <span id="opacityValue">100%</span>
                        </div>
                        <div class="property-row">
                            <label>Brightness:</label>
                            <input type="range" id="propBrightness" min="-100" max="100" value="0">
                            <span id="brightnessValue">0</span>
                        </div>
                        <div class="property-row">
                            <label>Contrast:</label>
                            <input type="range" id="propContrast" min="-100" max="100" value="0">
                            <span id="contrastValue">0</span>
                        </div>
                        <div class="property-row">
                            <label>Blur:</label>
                            <input type="range" id="propBlur" min="0" max="1" step="0.01" value="0">
                            <span id="blurValue">0</span>
                        </div>
                    </div>

                    <!-- Lock/Unlock -->
                    <div class="property-group">
                        <h3>Layer Control</h3>
                        <label class="checkbox-label">
                            <input type="checkbox" id="lockObject">
                            üîí Lock Object
                        </label>
                    </div>

                    <!-- Placeholder Metadata -->
                    <div class="property-group" id="placeholderMetadataGroup" style="display:none;">
                        <h3>Placeholder Metadata</h3>
                        <div class="property-row">
                            <label>Name:</label>
                            <input type="text" id="placeholderName" placeholder="e.g., Front Design">
                        </div>
                        <div class="property-row">
                            <label>Type:</label>
                            <input type="text" id="placeholderType" placeholder="e.g., tshirt-front">
                        </div>
                    </div>

                    <!-- Apply Design -->
                    <div class="property-group" id="applyDesignGroup">
                        <h3>Apply Design</h3>
                        <button id="applyDesignBtn" class="btn btn-primary btn-block">üé® Apply Selected Design</button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Mockup</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="property-row">
                    <label>Format:</label>
                    <select id="exportFormat">
                        <option value="png">PNG</option>
                        <option value="jpeg">JPEG</option>
                    </select>
                </div>
                <div class="property-row">
                    <label>Quality:</label>
                    <select id="exportQuality">
                        <option value="1">Highest (100%)</option>
                        <option value="0.9">High (90%)</option>
                        <option value="0.8">Medium (80%)</option>
                        <option value="0.7">Low (70%)</option>
                    </select>
                </div>
                <div class="property-row">
                    <label>DPI:</label>
                    <select id="exportDPI">
                        <option value="72">72 DPI (Screen)</option>
                        <option value="150">150 DPI (Good)</option>
                        <option value="300" selected>300 DPI (Print Quality)</option>
                        <option value="600">600 DPI (High Print)</option>
                    </select>
                </div>
                <div class="property-row">
                    <label>Scale:</label>
                    <select id="exportScale">
                        <option value="1">1x (Original)</option>
                        <option value="2" selected>2x</option>
                        <option value="3">3x</option>
                        <option value="4">4x</option>
                    </select>
                </div>
                <div class="property-row">
                    <label>Filename:</label>
                    <input type="text" id="exportFilename" value="mockup-export">
                </div>
            </div>
            <div class="modal-footer">
                <button id="exportConfirmBtn" class="btn btn-success">Export</button>
                <button class="modal-close btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display:none;">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.min.js"></script>
    <script type="module" src="app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('‚ùå Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>