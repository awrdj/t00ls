<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mockup Editor Pro - Fixed</title>
    <link rel="stylesheet" href="styles.css">

    <!-- Load external libraries first -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>üé® Mockup Editor Pro</h1>
            <div class="header-actions">
                <button id="saveAllBtn" class="btn btn-primary">
                    <i class="icon">üíæ</i> Save Changes
                </button>
                <button id="exportBtn" class="btn btn-success">
                    <i class="icon">üì•</i> Export
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar - Mockup Library -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h2>üì¶ Mockup Library</h2>
                    <button id="addMockupBtn" class="btn btn-secondary btn-block">
                        + Add Custom Mockup
                    </button>
                    <input type="file" id="mockupUpload" accept="image/*" multiple style="display:none;">

                    <div class="mockup-categories">
                        <button class="category-btn active" data-category="all">All</button>
                        <button class="category-btn" data-category="apparel">Apparel</button>
                        <button class="category-btn" data-category="accessories">Accessories</button>
                        <button class="category-btn" data-category="custom">Custom</button>
                    </div>

                    <div id="mockupList" class="mockup-list">
                        <div class="loading-placeholder">Loading mockups...</div>
                    </div>
                </div>

                <!-- Design Library -->
                <div class="sidebar-section">
                    <h2>üé® Design Library</h2>
                    <button id="addDesignBtn" class="btn btn-secondary btn-block">
                        + Upload Design
                    </button>
                    <input type="file" id="designUpload" accept="image/*" multiple style="display:none;">
                    <div id="designList" class="design-list">
                        <div class="empty-state">No designs uploaded yet</div>
                    </div>
                </div>
            </aside>

            <!-- Canvas Area -->
            <main class="canvas-area">
                <div class="canvas-toolbar">
                    <div class="toolbar-group">
                        <button id="addPlaceholderBtn" class="btn btn-icon" title="Add Placeholder">
                            ‚ûï Placeholder
                        </button>
                        <button id="removePlaceholderBtn" class="btn btn-icon" title="Remove Selected">
                            üóëÔ∏è Delete
                        </button>
                        <button id="duplicatePlaceholderBtn" class="btn btn-icon" title="Duplicate">
                            üìã Copy
                        </button>
                    </div>
                    <div class="toolbar-group">
                        <button id="toggleGridBtn" class="btn btn-icon" title="Toggle Grid">
                            üìê Grid
                        </button>
                        <button id="toggleSnapBtn" class="btn btn-icon active" title="Toggle Snapping">
                            üß≤ Snap
                        </button>
                        <button id="centerObjectBtn" class="btn btn-icon" title="Center Object">
                            ‚äπ Center
                        </button>
                    </div>
                    <div class="toolbar-group">
                        <button id="layerUpBtn" class="btn btn-icon" title="Bring Forward">‚¨ÜÔ∏è</button>
                        <button id="layerDownBtn" class="btn btn-icon" title="Send Backward">‚¨áÔ∏è</button>
                    </div>
                </div>

                <div class="canvas-wrapper">
                    <div class="canvas-container">
                        <canvas id="mainCanvas"></canvas>
                    </div>
                </div>

                <div class="canvas-info">
                    <span id="canvasZoom">100%</span>
                    <span id="canvasSize">No mockup loaded</span>
                    <span id="objectInfo"></span>
                </div>
            </main>

            <!-- Properties Panel -->
            <aside class="properties-panel">
                <h2>‚öôÔ∏è Properties</h2>

                <div id="noSelectionMsg" class="no-selection">
                    <p>Select an object to edit properties</p>
                </div>

                <div id="propertiesContent" class="properties-content" style="display:none;">
                    <!-- Transform -->
                    <div class="property-group">
                        <h3>Transform</h3>
                        <div class="property-row">
                            <label>X:</label>
                            <input type="number" id="propX" class="input-small" step="1">
                        </div>
                        <div class="property-row">
                            <label>Y:</label>
                            <input type="number" id="propY" class="input-small" step="1">
                        </div>
                        <div class="property-row">
                            <label>Width:</label>
                            <input type="number" id="propWidth" class="input-small" step="1">
                        </div>
                        <div class="property-row">
                            <label>Height:</label>
                            <input type="number" id="propHeight" class="input-small" step="1">
                        </div>
                        <div class="property-row">
                            <label>Rotation:</label>
                            <input type="number" id="propRotation" class="input-small" min="-360" max="360" step="1">
                            <span>¬∞</span>
                        </div>
                    </div>

                    <!-- Aspect Ratio -->
                    <div class="property-group">
                        <h3>Aspect Ratio</h3>
                        <select id="aspectRatioSelect" class="select-full">
                            <option value="free">Free</option>
                            <option value="1:1">1:1 (Square)</option>
                            <option value="4:3">4:3</option>
                            <option value="16:9">16:9</option>
                            <option value="3:4">3:4 (Portrait)</option>
                            <option value="9:16">9:16 (Portrait)</option>
                        </select>
                        <label class="checkbox-label">
                            <input type="checkbox" id="lockAspectRatio">
                            Lock Aspect Ratio
                        </label>
                    </div>

                    <!-- Opacity & Effects -->
                    <div class="property-group">
                        <h3>Appearance</h3>
                        <div class="property-row">
                            <label>Opacity:</label>
                            <input type="range" id="propOpacity" min="0" max="100" value="100">
                            <span id="opacityValue">100%</span>
                        </div>
                    </div>

                    <!-- Lock -->
                    <div class="property-group">
                        <h3>Layer Control</h3>
                        <label class="checkbox-label">
                            <input type="checkbox" id="lockObject">
                            üîí Lock Object
                        </label>
                    </div>

                    <!-- Apply Design -->
                    <div class="property-group">
                        <button id="applyDesignBtn" class="btn btn-primary btn-block">
                            üé® Apply Selected Design
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Mockup</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="property-row">
                    <label>Format:</label>
                    <select id="exportFormat">
                        <option value="png">PNG</option>
                        <option value="jpeg">JPEG</option>
                    </select>
                </div>
                <div class="property-row">
                    <label>Quality:</label>
                    <select id="exportQuality">
                        <option value="1">Highest (100%)</option>
                        <option value="0.9">High (90%)</option>
                        <option value="0.8">Medium (80%)</option>
                    </select>
                </div>
                <div class="property-row">
                    <label>Scale:</label>
                    <select id="exportScale">
                        <option value="1">1x (Original)</option>
                        <option value="2" selected>2x</option>
                        <option value="3">3x</option>
                        <option value="4">4x</option>
                    </select>
                </div>
                <div class="property-row">
                    <label>Filename:</label>
                    <input type="text" id="exportFilename" value="mockup-export" class="input-full">
                </div>
            </div>
            <div class="modal-footer">
                <button id="exportConfirmBtn" class="btn btn-success">Export Now</button>
                <button class="modal-close btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <p id="loadingText">Processing...</p>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Load scripts in correct order -->
    <script src="storage.js"></script>
    <script src="app.js"></script>
</body>
</html>